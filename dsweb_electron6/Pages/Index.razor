@page "/"
@using dsweb_electron6.Models;
@using Microsoft.AspNetCore.Components;
@using dsweb_electron6.Interfaces;
@using System.ComponentModel
@inject StartUp StartUp
@inject DSdataModel DSdata
@inject IUriHelper UriHelper
@inject IDSdata_cache  DScache
@inject ScanStateChange stateChanged

<h1>sc2dsstats</h1>

@if (StartUp.FIRSTRUN == true)
{
    <br />
    <div class="container">
        <h2>Welcome to sc2dsstats - this is your first run, so please check the options and press Save.</h2>
        <h3>You can change the settings at any time at 'Settings' in the Nav menu</h3>
    </div>
    <dsweb_electron6.Pages.Config />
}
else
{
    if (DSdata.Replays.Count > 10 && t.Days > 30 && stateChanged.Scan.Running == false)
    {
        <dsweb_electron6.Pages.Upload />
    }
    <dsweb_electron6.Pages.Scan />
}

<!--
<button name="btn_mode" class="btn btn-sm btn-primary" @onclick="@UpdateApp">Update</button>
-->
@code {

    TimeSpan t;

    protected override void OnInit()
    {
        StartUp.Init();
        DSdata.Init();
        t = DateTime.Now - StartUp.Conf.LastUpload;
        stateChanged.PropertyChanged += Update;
    }

    private async void Update(object sender, PropertyChangedEventArgs e)
    {
        await InvokeAsync(() =>
        {
            StateHasChanged();
            Task t = new Task(() => { });
            return t;
        });
    }

    void UpdateApp()
    {
        AppUpdate up = new AppUpdate();
        up.Test();


    }


    public void Dispose()
    {
        stateChanged.PropertyChanged -= Update;
    }

}