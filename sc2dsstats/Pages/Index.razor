@page "/"
@using sc2dsstats.Data;
@using System.ComponentModel;
@inject StartUp StartUp
@inject DSreplays DSdata
@inject IDSdata_cache  DScache
@inject ScanStateChange stateChanged
@implements IDisposable


<h1>sc2dsstats</h1>

@if (StartUp.FIRSTRUN == true)
{
    <br />
    <div class="container">
        <h2>Welcome to sc2dsstats - this is your first run, so please check the options and press Save.</h2>
        <h3>You can change the settings at any time at 'Settings' in the Nav menu</h3>
    </div>
    <Config />
}
else
{
    if (DSdata.Replays.Count > 10 && t.Days > 30 && stateChanged.Scan.Running == false)
    {
        <Upload />
    }
    if (Loading == true)
    {
        <a>Loading ..</a>
    }
    else
    {
        <Scan />
        @((MarkupString)@StartUp.FirstRunInfo)
    }
}


@code {
    TimeSpan t;
    bool Loading = true;


    protected override async Task OnInitializedAsync()
    {
        t = DateTime.Now - StartUp.Conf.LastUpload;
        Loading = false;

        stateChanged.PropertyChanged += Update;
    }


    private void Update(object sender, PropertyChangedEventArgs e)
    {
        InvokeAsync(() => StateHasChanged()).GetAwaiter();
    }

    public void Dispose()
    {
        stateChanged.PropertyChanged -= Update;
    }
}